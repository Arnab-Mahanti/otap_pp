#pragma once
#include "OTypes.h"
#include <memory>
#include <valarray>

namespace OTAP
{
    class AmbientBase
    {
    private:
        /* data */
    public:
        AmbientBase(/* args */) = default;
        virtual ~AmbientBase() = default;
        virtual std::vector<double> Pressure(std::vector<double>) const
        {
            assert(false);
        }
        virtual std::vector<double> Temperature(std::vector<double>) const
        {
            assert(false);
        }
        virtual std::vector<double> Density(std::vector<double>) const
        {
            assert(false);
        }
        // virtual std::valarray<double> Pressure(std::valarray<double>) const
        // {
        //     assert(false);
        // }
        // virtual std::valarray<double> Temperature(std::valarray<double>) const
        // {
        //     assert(false);
        // }
        // virtual std::valarray<double> Density(std::valarray<double>) const
        // {
        //     assert(false);
        // }
        virtual double Pressure(double) const
        {
            assert(false);
        }
        virtual double Temperature(double) const
        {
            assert(false);
        }
        virtual double Density(double) const
        {
            assert(false);
        }
    };

    class ISA_Ambient : public AmbientBase
    {
    private:
        // Units Alt,Press,Temp,Density >> km,Pa,K,kg/m^3f
        static inline const std::vector<double> m_altitudeData =
            {0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0,
             8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0,
             17.0, 18.0, 19.0, 20.0, 21.0, 22.0, 23.0, 24.0, 25.0,
             26.0, 27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0,
             35.0, 36.0, 37.0, 38.0, 39.0, 40.0, 41.0, 42.0, 43.0,
             44.0, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0,
             53.0, 54.0, 55.0, 56.0, 57.0, 58.0, 59.0, 60.0, 61.0,
             62.0, 63.0, 64.0, 65.0, 66.0, 67.0, 68.0, 69.0, 70.0,
             71.0, 72.0, 73.0, 74.0, 75.0, 76.0, 77.0, 78.0, 79.0,
             80.0, 81.0, 82.0, 83.0, 84.0, 85.0, 86.0, 87.0, 88.0,
             89.0, 90.0, 91.0, 92.0, 93.0, 94.0, 95.0, 96.0, 97.0,
             98.0, 99.0, 100.0, 101.0, 102.0, 103.0, 104.0, 105.0, 106.0,
             107.0, 108.0, 109.0, 110.0, 111.0, 112.0, 113.0, 114.0, 115.0,
             116.0, 117.0, 118.0, 119.0, 120.0, 121.0, 122.0, 123.0, 124.0,
             125.0, 126.0, 127.0, 128.0, 129.0, 130.0, 131.0, 132.0, 133.0,
             134.0, 135.0, 136.0, 137.0, 138.0, 139.0, 140.0, 141.0, 142.0,
             143.0, 144.0, 145.0, 146.0, 147.0, 148.0, 149.0, 150.0, 151.0,
             152.0, 153.0, 154.0, 155.0, 156.0, 157.0, 158.0, 159.0, 160.0,
             161.0, 162.0, 163.0, 164.0, 165.0, 166.0, 167.0, 168.0, 169.0,
             170.0, 171.0, 172.0, 173.0, 174.0, 175.0, 176.0, 177.0, 178.0,
             179.0, 180.0, 181.0, 182.0, 183.0, 184.0, 185.0, 186.0, 187.0,
             188.0, 189.0, 190.0, 191.0, 192.0, 193.0, 194.0, 195.0, 196.0,
             197.0, 198.0, 199.0, 200.0, 210.0, 220.0, 230.0, 240.0, 250.0,
             260.0, 270.0, 280.0, 290.0, 300.0, 310.0, 320.0, 330.0, 340.0,
             350.0, 360.0, 370.0, 380.0, 390.0, 400.0, 410.0, 420.0, 430.0,
             440.0, 450.0, 460.0, 470.0, 480.0, 490.0, 500.0, 510.0, 520.0,
             530.0, 540.0, 550.0, 560.0, 570.0, 580.0, 590.0, 600.0, 610.0,
             620.0, 630.0, 640.0, 650.0, 660.0, 670.0, 680.0, 690.0, 700.0,
             710.0, 720.0, 730.0, 740.0, 750.0, 760.0, 770.0, 780.0, 790.0,
             800.0, 810.0, 820.0, 830.0, 840.0, 850.0, 860.0, 870.0, 880.0,
             890.0, 900.0, 910.0, 920.0, 930.0, 940.0, 950.0, 960.0, 970.0,
             980.0, 990.0, 1000.0};

        static inline const std::vector<double> m_temperatureData =
            {300.7, 294.6, 288.4, 283.6, 278.4, 272.9, 267.2, 261.4,
             254.9, 247.9, 240.4, 232.4, 224.2, 215.9, 207.7, 200.8, 195.6,
             194.2, 197.3, 201.7, 206.6, 209.1, 212.2, 215.5, 218.8, 221.3,
             223.8, 226.0, 228.0, 230.3, 232.4, 234.4, 236.3, 238.4, 240.7,
             243.4, 246.1, 248.9, 251.7, 254.2, 256.6, 258.9, 260.6, 262.0,
             262.9, 263.8, 264.4, 264.7, 264.6, 264.1, 263.5, 262.5, 261.0,
             258.9, 256.4, 253.6, 251.1, 248.5, 245.3, 241.7, 238.0, 234.1,
             230.3, 226.9, 223.5, 220.4, 217.3, 213.9, 210.2, 207.3, 204.8,
             203.5, 201.7, 199.5, 197.0, 194.4, 193.4, 191.4, 190.6, 188.4,
             187.1, 185.6, 184.1, 182.8, 181.5, 180.3, 179.2, 178.2, 177.3,
             176.5, 175.7, 175.0, 174.5, 174.0, 173.6, 173.3, 173.1, 173.0,
             172.9, 173.4, 174.8, 177.1, 180.4, 184.7, 189.9, 196.0, 203.0,
             210.9, 219.8, 229.5, 239.9, 251.0, 262.7, 275.0, 288.0, 301.6,
             315.8, 330.5, 345.8, 361.4, 377.3, 393.3, 409.1, 424.6, 439.7,
             454.4, 468.7, 482.6, 496.2, 509.4, 522.3, 534.8, 547.1, 559.0,
             570.6, 581.9, 592.9, 603.6, 614.1, 624.3, 634.2, 643.9, 653.3,
             662.5, 671.4, 680.1, 688.6, 696.9, 705.0, 712.8, 720.5, 727.9,
             735.2, 742.3, 749.2, 755.9, 762.5, 768.8, 775.1, 781.1, 787.0,
             792.8, 798.4, 803.9, 809.2, 814.4, 819.4, 824.4, 829.2, 833.9,
             838.4, 842.9, 847.2, 851.4, 855.5, 859.6, 863.5, 867.3, 871.0,
             874.6, 878.1, 881.6, 884.9, 888.2, 891.4, 894.5, 897.5, 900.4,
             903.3, 906.1, 908.8, 911.5, 914.1, 916.6, 919.1, 921.5, 923.8,
             926.1, 928.3, 930.5, 932.6, 951.0, 965.3, 976.3, 984.9, 991.6,
             996.8, 1000.8, 1004.0, 1006.4, 1008.3, 1009.8, 1011.0, 1011.9, 1012.6,
             1013.2, 1013.6, 1014.0, 1014.2, 1014.4, 1014.6, 1014.7, 1014.8, 1014.9,
             1015.0, 1015.0, 1015.1, 1015.1, 1015.1, 1015.1, 1015.2, 1015.2, 1015.2,
             1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2,
             1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2,
             1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2,
             1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2,
             1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2, 1015.2,
             1015.2, 1015.2, 1015.2};

        static inline const std::vector<double> m_pressureData =
            {0.1009E+06, 0.8998E+05, 0.8006E+05, 0.7107E+05, 0.6297E+05,
             0.5565E+05, 0.4906E+05, 0.4314E+05, 0.3782E+05, 0.3303E+05, 0.2874E+05,
             0.2489E+05, 0.2145E+05, 0.1839E+05, 0.1566E+05, 0.1327E+05, 0.1118E+05,
             0.9395E+04, 0.7901E+04, 0.6667E+04, 0.5647E+04, 0.4798E+04, 0.4086E+04,
             0.3488E+04, 0.2985E+04, 0.2560E+04, 0.2199E+04, 0.1892E+04, 0.1631E+04,
             0.1407E+04, 0.1216E+04, 0.1052E+04, 0.9119E+03, 0.7911E+03, 0.6873E+03,
             0.5979E+03, 0.5210E+03, 0.4547E+03, 0.3975E+03, 0.3480E+03, 0.3050E+03,
             0.2677E+03, 0.2352E+03, 0.2068E+03, 0.1819E+03, 0.1602E+03, 0.1410E+03,
             0.1242E+03, 0.1094E+03, 0.9638E+02, 0.8487E+02, 0.7471E+02, 0.6572E+02,
             0.5777E+02, 0.5073E+02, 0.4448E+02, 0.3896E+02, 0.3407E+02, 0.2975E+02,
             0.2593E+02, 0.2256E+02, 0.1958E+02, 0.1695E+02, 0.1465E+02, 0.1263E+02,
             0.1086E+02, 0.9327E+01, 0.7990E+01, 0.6827E+01, 0.5819E+01, 0.4950E+01,
             0.4204E+01, 0.3567E+01, 0.3021E+01, 0.2556E+01, 0.2157E+01, 0.1817E+01,
             0.1529E+01, 0.1284E+01, 0.1078E+01, 0.9029E+00, 0.8508E+00, 0.7184E+00,
             0.6061E+00, 0.5108E+00, 0.4301E+00, 0.3617E+00, 0.3038E+00, 0.2549E+00,
             0.2135E+00, 0.1786E+00, 0.1491E+00, 0.1243E+00, 0.1035E+00, 0.8597E-01,
             0.7135E-01, 0.5916E-01, 0.4903E-01, 0.4065E-01, 0.3373E-01, 0.2805E-01,
             0.2338E-01, 0.1957E-01, 0.1645E-01, 0.1390E-01, 0.1182E-01, 0.1011E-01,
             0.8703E-02, 0.7542E-02, 0.6581E-02, 0.5779E-02, 0.5108E-02, 0.4542E-02,
             0.4063E-02, 0.3654E-02, 0.3304E-02, 0.3003E-02, 0.2741E-02, 0.2514E-02,
             0.2314E-02, 0.2139E-02, 0.1984E-02, 0.1846E-02, 0.1723E-02, 0.1612E-02,
             0.1512E-02, 0.1421E-02, 0.1339E-02, 0.1263E-02, 0.1194E-02, 0.1130E-02,
             0.1071E-02, 0.1017E-02, 0.9665E-03, 0.9197E-03, 0.8761E-03, 0.8354E-03,
             0.7974E-03, 0.7618E-03, 0.7284E-03, 0.6971E-03, 0.6676E-03, 0.6399E-03,
             0.6137E-03, 0.5890E-03, 0.5656E-03, 0.5435E-03, 0.5226E-03, 0.5027E-03,
             0.4839E-03, 0.4660E-03, 0.4489E-03, 0.4327E-03, 0.4173E-03, 0.4026E-03,
             0.3886E-03, 0.3752E-03, 0.3624E-03, 0.3502E-03, 0.3385E-03, 0.3273E-03,
             0.3166E-03, 0.3063E-03, 0.2965E-03, 0.2870E-03, 0.2780E-03, 0.2693E-03,
             0.2610E-03, 0.2530E-03, 0.2452E-03, 0.2378E-03, 0.2307E-03, 0.2238E-03,
             0.2172E-03, 0.2109E-03, 0.2047E-03, 0.1988E-03, 0.1931E-03, 0.1876E-03,
             0.1823E-03, 0.1772E-03, 0.1722E-03, 0.1674E-03, 0.1628E-03, 0.1583E-03,
             0.1540E-03, 0.1499E-03, 0.1458E-03, 0.1419E-03, 0.1381E-03, 0.1345E-03,
             0.1309E-03, 0.1275E-03, 0.1242E-03, 0.1209E-03, 0.1178E-03, 0.1148E-03,
             0.1119E-03, 0.1090E-03, 0.1062E-03, 0.1036E-03, 0.8073E-04, 0.6355E-04,
             0.5045E-04, 0.4035E-04, 0.3247E-04, 0.2628E-04, 0.2138E-04, 0.1748E-04,
             0.1434E-04, 0.1181E-04, 0.9768E-05, 0.8102E-05, 0.6740E-05, 0.5622E-05,
             0.4701E-05, 0.3940E-05, 0.3310E-05, 0.2786E-05, 0.2350E-05, 0.1986E-05,
             0.1681E-05, 0.1425E-05, 0.1210E-05, 0.1030E-05, 0.8776E-06, 0.7490E-06,
             0.6404E-06, 0.5485E-06, 0.4706E-06, 0.4045E-06, 0.3483E-06, 0.3005E-06,
             0.2598E-06, 0.2251E-06, 0.1955E-06, 0.1702E-06, 0.1485E-06, 0.1299E-06,
             0.1140E-06, 0.1003E-06, 0.8846E-07, 0.7830E-07, 0.6954E-07, 0.6196E-07,
             0.5539E-07, 0.4970E-07, 0.4475E-07, 0.4044E-07, 0.3668E-07, 0.3339E-07,
             0.3051E-07, 0.2798E-07, 0.2574E-07, 0.2377E-07, 0.2203E-07, 0.2048E-07,
             0.1910E-07, 0.1786E-07, 0.1676E-07, 0.1576E-07, 0.1486E-07, 0.1405E-07,
             0.1332E-07, 0.1265E-07, 0.1203E-07, 0.1147E-07, 0.1095E-07, 0.1048E-07,
             0.1004E-07, 0.9630E-08, 0.9251E-08, 0.8897E-08, 0.8566E-08, 0.8256E-08,
             0.7965E-08, 0.7692E-08, 0.7433E-08, 0.7190E-08, 0.6959E-08, 0.6740E-08};

        static inline const std::vector<double> m_densityData =
            {0.1169E+01, 0.1064E+01, 0.9672E+00, 0.8730E+00, 0.7881E+00,
             0.7106E+00, 0.6397E+00, 0.5749E+00, 0.5169E+00, 0.4643E+00, 0.4166E+00,
             0.3732E+00, 0.3334E+00, 0.2967E+00, 0.2627E+00, 0.2302E+00, 0.1991E+00,
             0.1686E+00, 0.1395E+00, 0.1152E+00, 0.9526E-01, 0.7994E-01, 0.6709E-01,
             0.5640E-01, 0.4753E-01, 0.4030E-01, 0.3423E-01, 0.2915E-01, 0.2491E-01,
             0.2129E-01, 0.1824E-01, 0.1564E-01, 0.1344E-01, 0.1156E-01, 0.9946E-02,
             0.8559E-02, 0.7375E-02, 0.6364E-02, 0.5502E-02, 0.4769E-02, 0.4141E-02,
             0.3603E-02, 0.3144E-02, 0.2750E-02, 0.2411E-02, 0.2115E-02, 0.1859E-02,
             0.1635E-02, 0.1441E-02, 0.1272E-02, 0.1122E-02, 0.9917E-03, 0.8776E-03,
             0.7777E-03, 0.6893E-03, 0.6111E-03, 0.5405E-03, 0.4775E-03, 0.4226E-03,
             0.3739E-03, 0.3303E-03, 0.2914E-03, 0.2565E-03, 0.2250E-03, 0.1969E-03,
             0.1718E-03, 0.1496E-03, 0.1301E-03, 0.1132E-03, 0.9779E-04, 0.8422E-04,
             0.7198E-04, 0.6163E-04, 0.5277E-04, 0.4486E-04, 0.3866E-04, 0.3274E-04,
             0.2784E-04, 0.2349E-04, 0.1994E-04, 0.1681E-04, 0.1475E-04, 0.1252E-04,
             0.1063E-04, 0.9011E-05, 0.7638E-05, 0.6471E-05, 0.5480E-05, 0.4638E-05,
             0.3924E-05, 0.3317E-05, 0.2802E-05, 0.2363E-05, 0.1988E-05, 0.1668E-05,
             0.1396E-05, 0.1164E-05, 0.9666E-06, 0.8002E-06, 0.6602E-06, 0.5430E-06,
             0.4453E-06, 0.3646E-06, 0.2985E-06, 0.2445E-06, 0.2006E-06, 0.1650E-06,
             0.1361E-06, 0.1128E-06, 0.9385E-07, 0.7851E-07, 0.6606E-07, 0.5589E-07,
             0.4755E-07, 0.4068E-07, 0.3498E-07, 0.3023E-07, 0.2627E-07, 0.2294E-07,
             0.2013E-07, 0.1776E-07, 0.1575E-07, 0.1404E-07, 0.1258E-07, 0.1133E-07,
             0.1025E-07, 0.9312E-08, 0.8492E-08, 0.7770E-08, 0.7132E-08, 0.6566E-08,
             0.6062E-08, 0.5610E-08, 0.5204E-08, 0.4839E-08, 0.4508E-08, 0.4208E-08,
             0.3935E-08, 0.3686E-08, 0.3458E-08, 0.3250E-08, 0.3058E-08, 0.2882E-08,
             0.2719E-08, 0.2568E-08, 0.2429E-08, 0.2300E-08, 0.2180E-08, 0.2068E-08,
             0.1964E-08, 0.1867E-08, 0.1777E-08, 0.1692E-08, 0.1612E-08, 0.1538E-08,
             0.1467E-08, 0.1402E-08, 0.1340E-08, 0.1281E-08, 0.1226E-08, 0.1174E-08,
             0.1125E-08, 0.1078E-08, 0.1034E-08, 0.9925E-09, 0.9529E-09, 0.9154E-09,
             0.8798E-09, 0.8460E-09, 0.8138E-09, 0.7832E-09, 0.7541E-09, 0.7263E-09,
             0.6998E-09, 0.6746E-09, 0.6505E-09, 0.6274E-09, 0.6054E-09, 0.5844E-09,
             0.5643E-09, 0.5450E-09, 0.5266E-09, 0.5089E-09, 0.4920E-09, 0.4757E-09,
             0.4602E-09, 0.4452E-09, 0.4309E-09, 0.4171E-09, 0.4039E-09, 0.3911E-09,
             0.3789E-09, 0.3671E-09, 0.3558E-09, 0.3449E-09, 0.3344E-09, 0.3243E-09,
             0.3146E-09, 0.3052E-09, 0.2961E-09, 0.2874E-09, 0.2152E-09, 0.1635E-09,
             0.1258E-09, 0.9786E-10, 0.7681E-10, 0.6078E-10, 0.4844E-10, 0.3885E-10,
             0.3134E-10, 0.2541E-10, 0.2070E-10, 0.1694E-10, 0.1392E-10, 0.1148E-10,
             0.9502E-11, 0.7887E-11, 0.6565E-11, 0.5479E-11, 0.4584E-11, 0.3843E-11,
             0.3229E-11, 0.2718E-11, 0.2292E-11, 0.1936E-11, 0.1637E-11, 0.1387E-11,
             0.1177E-11, 0.9997E-12, 0.8504E-12, 0.7242E-12, 0.6176E-12, 0.5273E-12,
             0.4507E-12, 0.3857E-12, 0.3305E-12, 0.2836E-12, 0.2436E-12, 0.2095E-12,
             0.1805E-12, 0.1556E-12, 0.1344E-12, 0.1163E-12, 0.1008E-12, 0.8744E-13,
             0.7602E-13, 0.6622E-13, 0.5779E-13, 0.5054E-13, 0.4430E-13, 0.3891E-13,
             0.3427E-13, 0.3025E-13, 0.2678E-13, 0.2377E-13, 0.2116E-13, 0.1889E-13,
             0.1691E-13, 0.1519E-13, 0.1369E-13, 0.1238E-13, 0.1123E-13, 0.1022E-13,
             0.9330E-14, 0.8547E-14, 0.7854E-14, 0.7241E-14, 0.6696E-14, 0.6211E-14,
             0.5779E-14, 0.5391E-14, 0.5044E-14, 0.4731E-14, 0.4448E-14, 0.4192E-14,
             0.3960E-14, 0.3748E-14, 0.3555E-14, 0.3377E-14, 0.3214E-14, 0.3064E-14};

    public:
        virtual std::vector<double> Pressure(std::vector<double> altitude) const override;
        virtual std::vector<double> Temperature(std::vector<double> altitude) const override;
        virtual std::vector<double> Density(std::vector<double> altitude) const override;

        // virtual std::valarray<double> Pressure(std::valarray<double> altitude) const override;
        // virtual std::valarray<double> Temperature(std::valarray<double> altitude) const override;
        // virtual std::valarray<double> Density(std::valarray<double> altitude) const override;

        virtual double Pressure(double altitude) const override;
        virtual double Temperature(double altitude) const override;
        virtual double Density(double altitude) const override;
    };

    template <typename... Args>
    std::shared_ptr<AmbientBase> make_ambient(AmbientType T, Args &&...args)
    {
        switch (T)
        {
        case AmbientType::ISA:
            return safe_make_shared<ISA_Ambient>(std::forward<Args>(args)...);
        default:
            assert(false);
            return nullptr;
        }
    }

    using Ambient = std::shared_ptr<AmbientBase>;
} // namespace OTAP
